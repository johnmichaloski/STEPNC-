<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>StepNC++: iges.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<h1>iges.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// iges.h</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">// DISCLAIMER: </span>
<a name="l00006"></a>00006 <span class="comment">//  This software was produced by the National Institute of Standards </span>
<a name="l00007"></a>00007 <span class="comment">//  and Technology (NIST), an agency of the U.S. government, and by statute is </span>
<a name="l00008"></a>00008 <span class="comment">//  not subject to copyright in the United States.  Recipients of this </span>
<a name="l00009"></a>00009 <span class="comment">//  software assume all responsibility associated with its operation,</span>
<a name="l00010"></a>00010 <span class="comment">//  modification,maintenance, and subsequent redistribution. </span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 <span class="comment">//  See NIST Administration Manual 4.09.07 b and Appendix I. </span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#pragma once</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include "atlstr.h"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "linalg3d.h"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "ClassUtils.h"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "boost/variant.hpp"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "boost/lexical_cast.hpp"</span>
<a name="l00028"></a>00028 <span class="keyword">using namespace </span>std;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keyword">namespace </span>Iges 
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033   <span class="keyword">struct </span>ABCD;
<a name="l00034"></a>00034   <span class="keyword">struct </span>ABCDEFGHIJKLMNOPQRS;
<a name="l00035"></a>00035   <span class="keyword">struct </span>XYZIJK;
<a name="l00036"></a>00036   <span class="keyword">struct </span>IGES_Globals;
<a name="l00037"></a>00037   <span class="keyword">struct </span>Entity;
<a name="l00038"></a>00038   <span class="keyword">struct </span>IGES_ENTITIES;
<a name="l00039"></a>00039   <span class="keyword">class </span>IgesModel;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   <span class="keyword">enum</span> Units { inches=1, millimeters, see15, feet, miles=5, meters=6, kilometers=7, mils=8, microns=9, centimeters=10, microinches=11};
<a name="l00042"></a>00042   <span class="keyword">enum</span> DraftingCode { igesnone=0, iso=0, ANFOR=2, ANSI=3, BSI=4, CSA=5, DIN=6, JIS=7};
<a name="l00043"></a>00043   <span class="keyword">enum</span> LineFontPattern { solid=1, dashed=2, phantom=3, centerline=4, dotted=5};
<a name="l00044"></a>00044   <span class="keyword">enum</span> ColorCode { NoColor=0, Black=1, Red=2, Green=3, Blue=4, Yellow=5, Magenta=6, Cyan=7, White=8};
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="keyword">struct </span>ABCD{ 
<a name="l00047"></a>00047     <span class="keywordtype">double</span> A,B,C,D; 
<a name="l00048"></a>00048     ABCD(<span class="keywordtype">double</span> a=0, <span class="keywordtype">double</span> b=0, <span class="keywordtype">double</span> c=0, <span class="keywordtype">double</span> d=0) : A(a), B(b), C(c), D(d) {}
<a name="l00049"></a>00049   } ;
<a name="l00050"></a>00050   <span class="keyword">struct </span>XYZIJK{ 
<a name="l00051"></a>00051     <span class="keywordtype">double</span> x,y,z,i,j,k; 
<a name="l00052"></a>00052     XYZIJK(<span class="keywordtype">double</span> X=0, <span class="keywordtype">double</span> Y=0, <span class="keywordtype">double</span> Z=0, <span class="keywordtype">double</span> I=0, <span class="keywordtype">double</span> J=0, <span class="keywordtype">double</span> K=0) : x(X), y(Y), z(Z), i(I), j(J), k(K) {}
<a name="l00053"></a>00053   } ;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="keyword">struct </span>ABCDEFGHIJKLMNOPQRS
<a name="l00056"></a>00056   {
<a name="l00057"></a>00057     <span class="keyword">union</span>{
<a name="l00058"></a>00058       <span class="keyword">struct</span>{
<a name="l00059"></a>00059         <span class="keywordtype">double</span> a,b,c,d, e,f,g,h, k,l,m,n, p,q,r,s;
<a name="l00060"></a>00060       };
<a name="l00061"></a>00061       <span class="keywordtype">double</span> data[19];
<a name="l00062"></a>00062     };
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   };
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   <span class="keyword">struct </span>ModelGlobals
<a name="l00067"></a>00067   {
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     ModelGlobals(); 
<a name="l00071"></a>00071     CString ToString(); 
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     VarDefs vars;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <span class="keyword">static</span> std::vector&lt;ColorMap&gt; igesColorIndex;
<a name="l00077"></a>00077     CString sParameterDelimiter,sRecordDelimiter,sProductId,sFilename,sSystemId,sPreprocessVersion; <span class="comment">// 1</span>
<a name="l00078"></a>00078     <span class="keywordtype">int</span> nIntegerBits,nMaxPowerTenFloat,nFloatingSignificantDigits,nMaxPowerTenDouble,nFloatingSignificantDigitsDbl;       <span class="comment">// 7</span>
<a name="l00079"></a>00079     CString sProductIdReceiving;  <span class="comment">// 12</span>
<a name="l00080"></a>00080     <span class="keywordtype">float</span> dModelSpaceScale;   <span class="comment">// 13</span>
<a name="l00081"></a>00081     <span class="keywordtype">int</span> nUnits; <span class="comment">// 14  1=inches, 2=mm, 3=, 4=feet, 5=miles, 6=meters</span>
<a name="l00082"></a>00082     CString sUnits; <span class="comment">// 15</span>
<a name="l00083"></a>00083     <span class="keywordtype">int</span> nMaxNumberLineWeight; <span class="comment">// 16</span>
<a name="l00084"></a>00084     <span class="keywordtype">float</span> dMaxLineWeightInUnits;  <span class="comment">// 17</span>
<a name="l00085"></a>00085     CString sDateTime;  <span class="comment">// 18</span>
<a name="l00086"></a>00086     <span class="keywordtype">float</span> dMinResolution; <span class="comment">// 19</span>
<a name="l00087"></a>00087     <span class="keywordtype">float</span> dMaxCoordinateValue;  <span class="comment">// 20</span>
<a name="l00088"></a>00088     CString sAuthor;  <span class="comment">// 21</span>
<a name="l00089"></a>00089     CString sOrganization;  <span class="comment">// 22</span>
<a name="l00090"></a>00090     <span class="keywordtype">int</span> nIgesVersion; <span class="comment">// 22</span>
<a name="l00091"></a>00091     <span class="keywordtype">int</span> nDraftingStandard;  <span class="comment">// 23</span>
<a name="l00092"></a>00092   };
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="keyword">struct </span>Entity 
<a name="l00096"></a>00096   {
<a name="l00097"></a>00097     Entity();
<a name="l00098"></a>00098     CString m_szEntityName;
<a name="l00099"></a>00099     <span class="keyword">virtual</span> <span class="keywordtype">int</span> GetEntityType() { <span class="keywordflow">return</span> ID; }
<a name="l00101"></a>00101     <span class="keywordtype">int</span> igesEntityGetType() { <span class="keywordflow">return</span> type; }
<a name="l00102"></a>00102     <span class="keywordtype">int</span> igesEntityGetColor() { <span class="keywordflow">return</span> color; }
<a name="l00103"></a>00103     <span class="keywordtype">int</span> igesEntityGetStatus() { <span class="keywordflow">return</span> status; }
<a name="l00104"></a>00104     <span class="keywordtype">int</span> igesEntityGetLine(){ <span class="keywordflow">return</span> line; }
<a name="l00105"></a>00105 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="keywordtype">int</span> ID;
<a name="l00109"></a>00109     <span class="keywordtype">int</span> type;                      <span class="comment">/* 1-8 entity type */</span>
<a name="l00110"></a>00110     <span class="keywordtype">int</span> datarec;                      <span class="comment">/* 9-16 parameter data */</span>
<a name="l00111"></a>00111     <span class="keywordtype">int</span> structure;                 <span class="comment">/* 17-24 parameter data */</span>
<a name="l00112"></a>00112     <span class="keywordtype">int</span> linefontpattern;            <span class="comment">/* 25-32 parameter data */</span>
<a name="l00113"></a>00113     <span class="keywordtype">int</span> level;            <span class="comment">/* 33-40 entity status */</span>
<a name="l00114"></a>00114     <span class="keywordtype">int</span> view;           <span class="comment">/* 41-48 entity status */</span>
<a name="l00115"></a>00115     <span class="keywordtype">int</span> pTransform;         <span class="comment">/* 49-56 entity status */</span>
<a name="l00116"></a>00116     <span class="keywordtype">int</span> labeldisplay;       <span class="comment">/* 57-64 entity status */</span>
<a name="l00117"></a>00117     <span class="keywordtype">int</span> status;                    <span class="comment">/* 65-72 entity status */</span>
<a name="l00118"></a>00118     <span class="keywordtype">int</span> seqnum;                    <span class="comment">/* 73-80 sequence num*/</span>
<a name="l00119"></a>00119     <span class="keywordtype">int</span> line;                      <span class="comment">/* sequence number */</span>
<a name="l00120"></a>00120     <span class="keywordtype">int</span> nForm;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="keywordtype">int</span> lineweight;         <span class="comment">/* 9-15 line weight */</span>
<a name="l00123"></a>00123     <span class="keywordtype">int</span> color;            <span class="comment">/* 17-24 color number */</span>
<a name="l00124"></a>00124     <span class="keywordtype">int</span> parameterlinecount;     <span class="comment">/* 25-32 parameter line count */</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="keywordtype">int</span> nAssocPointers;
<a name="l00127"></a>00127     std::vector&lt;int&gt; m_vAssocPtrs;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordtype">int</span> nPropertyPointers;
<a name="l00130"></a>00130     std::vector&lt;int&gt; m_vPropertyPtrs;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">// Derived values;</span>
<a name="l00133"></a>00133     <span class="keywordtype">int</span> nBlank;
<a name="l00134"></a>00134     <span class="keywordtype">int</span> nSubordinate;
<a name="l00135"></a>00135     <span class="keywordtype">int</span> nUseFlag;
<a name="l00136"></a>00136     <span class="keywordtype">int</span> nHierarchy;
<a name="l00137"></a>00137     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sBlankStatus[2];
<a name="l00138"></a>00138     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sSubordinateStatus[4];
<a name="l00139"></a>00139     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sEntityUseStatus[6];
<a name="l00140"></a>00140     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sHierarchyStatus[3];
<a name="l00141"></a>00141     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR *  sLineFontPattern[6];
<a name="l00142"></a>00142     <span class="comment">/*short translated;                flag if the entity has been processed */</span>
<a name="l00143"></a>00143     std::vector&lt;void *&gt; param;    <span class="comment">/* GSList containing params */</span>
<a name="l00144"></a>00144     std::vector&lt;int&gt; m_nPointers; <span class="comment">// pointes to directory entities for the constituent entities.</span>
<a name="l00145"></a>00145     std::vector&lt;Entity *&gt; m_SubEntities;
<a name="l00146"></a>00146     CStringVector tokens ;
<a name="l00147"></a>00147     VarDefs vars;
<a name="l00148"></a>00148     CString sBlank;
<a name="l00149"></a>00149     CString m_szErrmsg;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   };
<a name="l00152"></a>00152 
<a name="l00153"></a>00153   <span class="keyword">struct </span>Entity1
<a name="l00154"></a>00154   {
<a name="l00155"></a>00155     CString m_szEntityName;
<a name="l00156"></a>00156     <span class="keywordtype">int</span> ID;
<a name="l00157"></a>00157     <span class="keyword">enum</span> { none_, point_, circarc_, arc3d_, line_, xform_ };
<a name="l00158"></a>00158     <span class="keywordtype">int</span> type; <span class="comment">// iges type</span>
<a name="l00159"></a>00159     <span class="keywordtype">int</span> _type;
<a name="l00160"></a>00160     <span class="keyword">virtual</span> CString ToXmlString(){ <span class="keywordflow">return</span> <span class="stringliteral">""</span>; }
<a name="l00161"></a>00161     <span class="keyword">virtual</span> <span class="keywordtype">void</span> FromXmlString(CString str){  }
<a name="l00162"></a>00162     <span class="keywordtype">bool</span> IsLine() { <span class="keywordflow">return</span> _type == line_; }
<a name="l00163"></a>00163     <span class="keywordtype">bool</span> IsPoint() { <span class="keywordflow">return</span> _type == point_; }
<a name="l00164"></a>00164     <span class="keywordtype">bool</span> IsArc() { <span class="keywordflow">return</span> _type == arc3d_; }
<a name="l00165"></a>00165     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> FirstPoint() { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(); }
<a name="l00166"></a>00166     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> LastPoint() { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(); }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   };
<a name="l00169"></a>00169   <span class="keyword">struct </span>Transform : <span class="keyword">public</span> Entity1
<a name="l00170"></a>00170   {
<a name="l00171"></a>00171     <span class="keyword">enum</span> FormFactor { OrthogonalRH=0, OrthogonalLH=1};
<a name="l00172"></a>00172 
<a name="l00174"></a>00174     <span class="comment">// TransformEntity</span>
<a name="l00175"></a>00175     Transform(<span class="keywordtype">double</span> d11, <span class="keywordtype">double</span> d12, <span class="keywordtype">double</span> d13, <span class="keywordtype">double</span> d14, 
<a name="l00176"></a>00176       <span class="keywordtype">double</span> d21, <span class="keywordtype">double</span> d22, <span class="keywordtype">double</span> d23, <span class="keywordtype">double</span> d24, 
<a name="l00177"></a>00177       <span class="keywordtype">double</span> d31, <span class="keywordtype">double</span> d32, <span class="keywordtype">double</span> d33, <span class="keywordtype">double</span> d34) ;
<a name="l00178"></a>00178     Transform(<a class="code" href="classMtx.html">Matrix</a> m) : matrix(m) { _type= xform_;}
<a name="l00180"></a>00180     <span class="keyword">virtual</span> CString ToString();
<a name="l00181"></a>00181     <span class="comment">//  virtual double DrawRaw(Pnts * pPts);</span>
<a name="l00183"></a>00183 <span class="comment"></span>    <a class="code" href="classMtx.html">Matrix</a> matrix;
<a name="l00184"></a>00184     <span class="keywordtype">int</span> n; <span class="comment">// 1 - number of entities</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   };
<a name="l00187"></a>00187   <span class="keyword">struct </span>Point : <span class="keyword">public</span> Entity1
<a name="l00188"></a>00188   {
<a name="l00189"></a>00189     Point(<span class="keywordtype">double</span> x1=0, <span class="keywordtype">double</span> y1=0, <span class="keywordtype">double</span> z1=0);
<a name="l00190"></a>00190     Point(<a class="code" href="classVec.html">Vector</a>);
<a name="l00192"></a>00192     <span class="keyword">virtual</span> CString ToXmlString();
<a name="l00193"></a>00193     <span class="keyword">virtual</span> <span class="keywordtype">void</span> FromXmlString(CString str);
<a name="l00194"></a>00194     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> GetPoint(<span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v=0.0) ;
<a name="l00196"></a>00196     Point3d pt;
<a name="l00197"></a>00197     <span class="keywordtype">float</span>&amp; X1;  <span class="comment">// 1- X start point</span>
<a name="l00198"></a>00198     <span class="keywordtype">float</span>&amp; Y1;  <span class="comment">// 2- Y  start point</span>
<a name="l00199"></a>00199     <span class="keywordtype">float</span>&amp; Z1;  <span class="comment">// 3- Z start point </span>
<a name="l00200"></a>00200     <a class="code" href="classVec.html">Vector</a> FirstPoint() { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(X1,Y1,Z1); }
<a name="l00201"></a>00201     <a class="code" href="classVec.html">Vector</a> LastPoint() { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(X1,Y1,Z1); }
<a name="l00202"></a>00202   };
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   <span class="keyword">struct </span>Line : <span class="keyword">public</span> Entity1
<a name="l00205"></a>00205   {
<a name="l00206"></a>00206     Line(<span class="keywordtype">double</span> x1=0, <span class="keywordtype">double</span> y1=0, <span class="keywordtype">double</span> z1=0, <span class="keywordtype">double</span> x2=0, <span class="keywordtype">double</span> y2=0, <span class="keywordtype">double</span> z2=0)  ;
<a name="l00207"></a>00207     Line(<a class="code" href="classVec.html">Vector</a> v1, <a class="code" href="classVec.html">Vector</a> v2)  ;
<a name="l00209"></a>00209     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> GetPoint(<span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v=0.0) ;
<a name="l00210"></a>00210     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> GetStart(<span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v=0.0) { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(_pt1); }
<a name="l00211"></a>00211     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> GetEnd(<span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v=0.0) { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(_pt2); }
<a name="l00212"></a>00212     <span class="keyword">virtual</span> REAL Magnitude() { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(_pt2-_pt1).Len(); }
<a name="l00213"></a>00213     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> Direction() { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vector</a>(_pt2-_pt1).<a class="code" href="classVec.html#021b7dfcbe29646a2551e5d771215466">Normalize</a>(); }
<a name="l00214"></a>00214     CString ToXmlString();
<a name="l00215"></a>00215     <span class="keywordtype">void</span> FromXmlString(CString str);
<a name="l00216"></a>00216     <a class="code" href="classVec.html">Vector</a> FindNearestPt(<a class="code" href="classVec.html">Vector</a> pt )
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       <a class="code" href="classVec.html">Vector</a> v1(_pt1), v2(_pt2), _dir( Direction());
<a name="l00219"></a>00219       <span class="keywordflow">return</span> ( v1 + _dir  * Dot(pt - v1, _dir) / _dir.Norm() );
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221     REAL Distance(Point3d pt) { <span class="keywordflow">return</span>  <a class="code" href="classVec.html">Vector</a>(<a class="code" href="classVec.html">Vector</a>(pt) - FindNearestPt(pt)).Len(); }
<a name="l00222"></a>00222     <a class="code" href="classVec.html">Vector</a> FirstPoint() { <span class="keywordflow">return</span> _pt1; }
<a name="l00223"></a>00223     <a class="code" href="classVec.html">Vector</a> LastPoint() { <span class="keywordflow">return</span> _pt2; }
<a name="l00225"></a>00225     <a class="code" href="classVec.html">Vector</a> _pt1;
<a name="l00226"></a>00226     <a class="code" href="classVec.html">Vector</a> _pt2;
<a name="l00227"></a>00227   };
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment">/* 3d arc */</span>
<a name="l00230"></a>00230   <span class="keyword">struct </span>Arc3D : <span class="keyword">public</span> Entity1
<a name="l00231"></a>00231   {
<a name="l00232"></a>00232     <a class="code" href="classVec.html">Vector</a> ep1, ep2;    <span class="comment">/* Arc endpoints */</span>
<a name="l00233"></a>00233     <a class="code" href="classVec.html">Vector</a> c;           <span class="comment">/* Arc center, relative to view */</span>
<a name="l00234"></a>00234     REAL radius;           <span class="comment">/* Arc radius */</span>
<a name="l00235"></a>00235     REAL sa;          <span class="comment">/* Start angle in radians */</span>
<a name="l00236"></a>00236     REAL sw;          <span class="comment">/* Sweep angle in radians */</span>
<a name="l00237"></a>00237     Arc3D() {   _type= arc3d_; }
<a name="l00238"></a>00238     Arc3D(<a class="code" href="classVec.html">Vector</a> ep1, <a class="code" href="classVec.html">Vector</a> ep2, <a class="code" href="classVec.html">Vector</a> center, REAL radius, REAL startangle, REAL sweepangle);
<a name="l00239"></a>00239     CString ToXmlString();
<a name="l00240"></a>00240     <span class="keywordtype">void</span> FromXmlString(CString str);         
<a name="l00241"></a>00241     <a class="code" href="classVec.html">Vector</a> FirstPoint() { <span class="keywordflow">return</span> ep1; }
<a name="l00242"></a>00242     <a class="code" href="classVec.html">Vector</a> LastPoint() { <span class="keywordflow">return</span> ep2; }
<a name="l00243"></a>00243     <span class="keywordtype">void</span> Init() { ep1=<a class="code" href="classVec.html">Vector</a>(); ep2=<a class="code" href="classVec.html">Vector</a>(); c=<a class="code" href="classVec.html">Vector</a>(); radius=0.0; sa=0.0; sw=0.0; }
<a name="l00244"></a>00244   };
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="comment">// X(u) = AX(i) + BX(i) * s + CX(i) * pow(s,2) + DX(i) * pow(s,3)</span>
<a name="l00247"></a>00247   <span class="comment">// Y(u) = AY(i) + BY(i) * s + CY(i) * pow(s,2) + DY(i) * pow(s,3)</span>
<a name="l00248"></a>00248   <span class="comment">// Z(u) = AZ(i) + BZ(i) * s + CZ(i) * pow(s,2) + DZ(i) * pow(s,3)</span>
<a name="l00249"></a>00249   <span class="comment">//</span>
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="keyword">struct </span>CircularArc : <span class="keyword">public</span> Entity1
<a name="l00253"></a>00253   {
<a name="l00254"></a>00254     CircularArc();
<a name="l00255"></a>00255     <a class="code" href="classVec.html">Vector</a> GetPoint(<span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v) ;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <a class="code" href="classVec.html">Vector</a> ep1, ep2;    <span class="comment">/* Arc endpoints */</span>
<a name="l00258"></a>00258     <a class="code" href="classVec.html">Vector</a> c;           <span class="comment">/* Arc center, relative to view */</span>
<a name="l00259"></a>00259     REAL radius;           <span class="comment">/* Arc radius */</span>
<a name="l00260"></a>00260     REAL sa;          <span class="comment">/* Start angle in radians */</span>
<a name="l00261"></a>00261     REAL sw;          <span class="comment">/* Sweep angle in radians */</span>
<a name="l00262"></a>00262 
<a name="l00264"></a>00264     <span class="keywordtype">float</span> ZT;  <span class="comment">// 1 - parallel ZT displacement of arc form XT, YT plane</span>
<a name="l00265"></a>00265     <span class="keywordtype">float</span> X1;  <span class="comment">// 2- arc center abscissa</span>
<a name="l00266"></a>00266     <span class="keywordtype">float</span> Y1; <span class="comment">// 3- arc center ordinate</span>
<a name="l00267"></a>00267     <span class="keywordtype">float</span> X2; <span class="comment">// 4 - start point abscissa</span>
<a name="l00268"></a>00268     <span class="keywordtype">float</span> Y2; <span class="comment">// 5 start point ordinate</span>
<a name="l00269"></a>00269     <span class="keywordtype">float</span> X3; <span class="comment">// 6 - termiante point absicssa</span>
<a name="l00270"></a>00270     <span class="keywordtype">float</span> Y3; <span class="comment">// 7 - terminate point ordinate</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   };
<a name="l00273"></a>00273 <span class="preprocessor">#if 0</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>  <span class="comment">/*  CompositeEntity entity;</span>
<a name="l00275"></a>00275 <span class="comment">  Point &amp; pt = entity.get&lt;Point&gt;();</span>
<a name="l00276"></a>00276 <span class="comment">  pt.X1 = 1;</span>
<a name="l00277"></a>00277 <span class="comment">  pt.Y1 = 1;</span>
<a name="l00278"></a>00278 <span class="comment">  pt.Z1 = 1;</span>
<a name="l00279"></a>00279 <span class="comment">  */</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   <span class="keyword">class </span>CompositeEntity :
<a name="l00282"></a>00282     <span class="keyword">public</span> Point,
<a name="l00283"></a>00283     <span class="keyword">public</span> CircularArc,
<a name="l00284"></a>00284     <span class="keyword">public</span> Arc3D,
<a name="l00285"></a>00285     <span class="keyword">public</span> Line
<a name="l00286"></a>00286   {
<a name="l00287"></a>00287   <span class="keyword">public</span>:
<a name="l00288"></a>00288     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; 
<a name="l00289"></a>00289     T &amp; <span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> (*((T*) <span class="keyword">this</span>)); }
<a name="l00290"></a>00290     CompositeEntity() { _type = none_; }
<a name="l00291"></a>00291     CompositeEntity(Point p) : Point(p) { _type = point_; }
<a name="l00292"></a>00292     CompositeEntity(CircularArc a) : CircularArc(a) { _type = circarc_; }
<a name="l00293"></a>00293     CompositeEntity(Arc3D a) : Arc3D(a) { _type = arc3d_; }
<a name="l00294"></a>00294     CompositeEntity(Line a) : Line(a) { _type = line_; }
<a name="l00295"></a>00295     <span class="comment">// FIXME: add closed boolean</span>
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     CompositeEntity&amp; operator=(<span class="keyword">const</span> CompositeEntity&amp; rhs)
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (<span class="keyword">this</span> !=&amp;rhs)
<a name="l00300"></a>00300       {
<a name="l00301"></a>00301         this-&gt;~CompositeEntity();<span class="comment">//destroy self</span>
<a name="l00302"></a>00302         <span class="keyword">new</span> (<span class="keyword">this</span>) CompositeEntity(rhs);<span class="comment">//reconstruct self using placement new and copy ctor</span>
<a name="l00303"></a>00303       }
<a name="l00304"></a>00304       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306     CString ToString();
<a name="l00307"></a>00307     <span class="keywordtype">void</span> FromString(CString);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   };
<a name="l00310"></a>00310 <span class="preprocessor">#endif</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>  <span class="comment">// Composite  is defined as an ordered list of entites of the following tuypes: point, line, circular arc,</span>
<a name="l00312"></a>00312   <span class="comment">// conic ar, parametric spline, rational B-spline, and connect point.</span>
<a name="l00313"></a>00313   <span class="keyword">struct </span>CompositeCurve : <span class="keyword">public</span> Entity, <span class="keyword">public</span> std::vector&lt;Entity1 *&gt;
<a name="l00314"></a>00314   {
<a name="l00315"></a>00315     CompositeCurve();
<a name="l00317"></a>00317     CString ToXmlString();
<a name="l00318"></a>00318     <span class="keywordtype">void</span> AddXmlEntity(CString);
<a name="l00319"></a>00319   
<a name="l00320"></a>00320     <span class="keywordtype">int</span> AddEntity(Point p) { push_back( <span class="keyword">new</span> Point(p)); <span class="keywordflow">return</span> size();}
<a name="l00321"></a>00321     <span class="keywordtype">int</span> AddEntity(Arc3D a) { push_back( <span class="keyword">new</span>  Arc3D(a)); <span class="keywordflow">return</span> size();}
<a name="l00322"></a>00322     <span class="keywordtype">int</span> AddEntity(Line a) { push_back( <span class="keyword">new</span> Line(a)); <span class="keywordflow">return</span> size();}
<a name="l00323"></a>00323     <span class="keywordtype">int</span> AddEntity(Transform t) { push_back( <span class="keyword">new</span> Transform(t)); <span class="keywordflow">return</span> size();}
<a name="l00324"></a>00324 
<a name="l00326"></a>00326     <span class="keywordtype">int</span> n; <span class="comment">// 1 - number of entities</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   };
<a name="l00329"></a>00329   <span class="comment">// A * XT*T + B * XT * YT + C * YT * YT + D * XT + E * YT + F = 0</span>
<a name="l00330"></a>00330   <span class="keyword">struct </span>ConicArc : <span class="keyword">public</span> Entity
<a name="l00331"></a>00331   {
<a name="l00332"></a>00332     <span class="keyword">enum</span> FormFactor { General=0, Ellipse=1, Hyperbola=2, Parabola=3};
<a name="l00333"></a>00333     ConicArc();
<a name="l00334"></a>00334 
<a name="l00336"></a>00336     <span class="keyword">virtual</span> <a class="code" href="classVec.html">Vector</a> GetPoint(<span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v=0.0) ;
<a name="l00337"></a>00337     CString ToString();
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordtype">float</span> A,B,C,D,E,F, ZT, X1, Y1, X2, Y2; 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342   };
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   <span class="keyword">struct </span>CopiusData : <span class="keyword">public</span> Entity
<a name="l00345"></a>00345   {
<a name="l00346"></a>00346     CopiusData()
<a name="l00347"></a>00347     { 
<a name="l00348"></a>00348       type=ID=106;  
<a name="l00349"></a>00349       m_szEntityName=_T(<span class="stringliteral">"CopiusData"</span>);
<a name="l00350"></a>00350     }
<a name="l00352"></a>00352     CString ToString();
<a name="l00354"></a>00354     <span class="keywordtype">int</span> IP; <span class="comment">// 1- interpretation flag: 1=x,y pairs, 2=x,y,z coordinates, 3=x,y,z, coordinates i,j,j vectors</span>
<a name="l00355"></a>00355     <span class="keywordtype">int</span> nNum; <span class="comment">// 2 - number of n-tuples </span>
<a name="l00356"></a>00356     std::vector&lt;XYZIJK&gt; xyzijks;
<a name="l00357"></a>00357     <span class="keywordtype">double</span> ZT;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   };
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="keyword">struct </span>ParametricSpline : <span class="keyword">public</span> Entity
<a name="l00362"></a>00362   {
<a name="l00363"></a>00363     ParametricSpline(<span class="keywordtype">int</span> ctype=0, <span class="keywordtype">int</span> h=0, <span class="keywordtype">int</span> ndim=0, <span class="keywordtype">int</span> n=0);
<a name="l00365"></a>00365     CString ToString();
<a name="l00366"></a>00366 
<a name="l00368"></a>00368     <span class="keyword">enum</span> Type { Linear=1, Quadratic=2, Cubic=3, Wilson_Fowler=4, Modified_Wilson_Fowler=5, B_Spline=6};
<a name="l00369"></a>00369     <span class="keywordtype">int</span> CTYPE; <span class="comment">// 1 - type</span>
<a name="l00370"></a>00370     <span class="keywordtype">int</span> H;    <span class="comment">// 2 - degree of continuitywith respect to arc length 0=continuous, 1=continuous&amp;slope continuous, 2=continuous&amp;slope&amp; Curvature continuous</span>
<a name="l00371"></a>00371     <span class="keywordtype">int</span> NDIM; <span class="comment">// 3 - number of dimensions, 2=planar, 3=non-planar</span>
<a name="l00372"></a>00372     <span class="keywordtype">int</span> N;    <span class="comment">// 4- number of segments;</span>
<a name="l00373"></a>00373     FloatList  Ts;
<a name="l00374"></a>00374     std::vector&lt;ABCD&gt;  XCoordinatePolynomial;  <span class="comment">// 0..n</span>
<a name="l00375"></a>00375     std::vector&lt;ABCD&gt;  YCoordinatePolynomial;  <span class="comment">// 0..n</span>
<a name="l00376"></a>00376     std::vector&lt;ABCD&gt;  ZCoordinatePolynomial;  <span class="comment">// 0..n </span>
<a name="l00377"></a>00377   };
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   <span class="comment">// A* XT + B *YT + C * ZT = D</span>
<a name="l00380"></a>00380   <span class="keyword">struct </span>PlaneEntity  : <span class="keyword">public</span> Entity
<a name="l00381"></a>00381   {
<a name="l00382"></a>00382     PlaneEntity();
<a name="l00384"></a>00384     CString ToString();
<a name="l00386"></a>00386     <span class="keywordtype">float</span> A; <span class="comment">// 1 -  coefficient</span>
<a name="l00387"></a>00387     <span class="keywordtype">float</span> B; <span class="comment">// 2 -  coefficient</span>
<a name="l00388"></a>00388     <span class="keywordtype">float</span> C; <span class="comment">// 3 -  coefficient</span>
<a name="l00389"></a>00389     <span class="keywordtype">float</span> D; <span class="comment">// 4 -  coefficient</span>
<a name="l00390"></a>00390     <span class="keywordtype">int</span> PTR ;
<a name="l00391"></a>00391     <span class="keywordtype">double</span> X, Y, Z, SIZE;
<a name="l00392"></a>00392   };
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   <span class="keyword">struct </span>ParametricSplineSurface  : <span class="keyword">public</span> Entity
<a name="l00395"></a>00395   {
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     ParametricSplineSurface(){ ID=114;  m_szEntityName=_T(<span class="stringliteral">"ParametricSplineSurfaceEntity"</span>);}
<a name="l00398"></a>00398     ~ParametricSplineSurface() {  }
<a name="l00399"></a>00399 
<a name="l00401"></a>00401     <a class="code" href="classVec.html">Vector</a> CalcPoint(<span class="keywordtype">double</span> s, <span class="keywordtype">double</span> t, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);
<a name="l00402"></a>00402     CString ToString();
<a name="l00403"></a>00403 
<a name="l00405"></a>00405     <span class="keywordtype">int</span> CTYPE, PTYPE, M, N;
<a name="l00406"></a>00406     std::vector&lt;double&gt;  TUs;
<a name="l00407"></a>00407     std::vector&lt;double&gt;  TVs;
<a name="l00408"></a>00408     <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">int</span> m_nP=19;
<a name="l00409"></a>00409     vector&lt;vector&lt;ABCDEFGHIJKLMNOPQRS&gt; &gt; Xs;
<a name="l00410"></a>00410     vector&lt;vector&lt;ABCDEFGHIJKLMNOPQRS&gt; &gt; Ys;
<a name="l00411"></a>00411     vector&lt;vector&lt;ABCDEFGHIJKLMNOPQRS&gt; &gt; Zs;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   };
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="keyword">struct </span>RuledSurface : <span class="keyword">public</span> Entity
<a name="l00416"></a>00416   {
<a name="l00417"></a>00417     RuledSurface();
<a name="l00419"></a>00419     <span class="keyword">virtual</span> CString ToString();
<a name="l00421"></a>00421     <span class="keywordtype">int</span> DE1, DE2;       <span class="comment">// DE1-Dictionary Entry 1, DE2-Dictionary Entry 2</span>
<a name="l00422"></a>00422     <span class="keywordtype">int</span> DIRFLG;     <span class="comment">// Direction flag 0=join first to first, last to last, 1=join first to last, last to first</span>
<a name="l00423"></a>00423     <span class="keywordtype">int</span> DEVFLG;     <span class="comment">// Devlopable sruface flag 1=developable, 0= possibly not</span>
<a name="l00424"></a>00424   };
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a>00429   <span class="keyword">struct </span>BSpline  : <span class="keyword">public</span> Entity
<a name="l00430"></a>00430   {
<a name="l00431"></a>00431     BSpline(){ type=ID=126;  m_szEntityName=_T(<span class="stringliteral">"BSplineEntity"</span>);}
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="keyword">enum</span> FormFactor { TBD=0, Line=1, CircularArc=2, EllipticalArc=3, ParabolicArc=4, HyperbolicArc=5};
<a name="l00434"></a>00434     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sFormFactors[6];
<a name="l00436"></a>00436     <span class="keyword">virtual</span> CString ToString();
<a name="l00437"></a>00437     <span class="keywordtype">double</span> BasisFcn(<span class="keyword">const</span> <span class="keywordtype">int</span> i, <span class="keyword">const</span> <span class="keywordtype">int</span> k, <span class="keyword">const</span> <span class="keywordtype">double</span> u, FloatList&amp; t);
<a name="l00439"></a>00439     <span class="keywordtype">int</span> K,M, nPLANAR, nOpenClosed, nRational, nPeriodic;
<a name="l00440"></a>00440     <span class="keywordtype">int</span> N, A;
<a name="l00441"></a>00441     FloatList  Ts;
<a name="l00442"></a>00442     FloatList  Ws;
<a name="l00443"></a>00443     VectorList  P;
<a name="l00444"></a>00444     <span class="keywordtype">float</span> V[2];
<a name="l00445"></a>00445     <span class="keywordtype">float</span> XNORM, YNORM, ZNORM;
<a name="l00446"></a>00446   };
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   <span class="keyword">struct </span>SurfaceRevolution  : <span class="keyword">public</span> Entity
<a name="l00450"></a>00450   {
<a name="l00451"></a>00451     SurfaceRevolution();
<a name="l00453"></a>00453     <span class="keyword">virtual</span> CString ToString();
<a name="l00455"></a>00455     <span class="keywordtype">int</span> L, C;       <span class="comment">// L - line, C- pointer to geometry generatrix </span>
<a name="l00456"></a>00456     <span class="keywordtype">float</span> SA, TA;  <span class="comment">// start angle and terminate angle in radians</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458   };
<a name="l00459"></a>00459   <span class="keyword">struct </span>TabulatedCylinder  : <span class="keyword">public</span> Entity
<a name="l00460"></a>00460   {
<a name="l00461"></a>00461     TabulatedCylinder();
<a name="l00463"></a>00463     <span class="keyword">virtual</span> CString ToString();
<a name="l00465"></a>00465     <span class="keywordtype">int</span> DE;       <span class="comment">// DE-Dictionary Entry to directrix curve</span>
<a name="l00466"></a>00466     <span class="keywordtype">float</span> LX, LY, LZ; <span class="comment">// Coordinates of terminate point of the generatrix. </span>
<a name="l00467"></a>00467     <span class="comment">//Start point is identical to start point of generatrix.</span>
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   };
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <span class="keyword">struct </span>Flash  : <span class="keyword">public</span> Entity
<a name="l00472"></a>00472   {
<a name="l00473"></a>00473     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sForms[6] ;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     Flash();
<a name="l00477"></a>00477     <span class="keyword">virtual</span> CString ToString();
<a name="l00479"></a>00479     <span class="keywordtype">float</span> X,Y;        <span class="comment">// X, Y reference of flash</span>
<a name="l00480"></a>00480     <span class="keywordtype">float</span> DIM1, DIM2;   <span class="comment">// First and second flash sizing parameter</span>
<a name="l00481"></a>00481     <span class="keywordtype">float</span> ROT;        <span class="comment">// rotation of flas about reference point</span>
<a name="l00482"></a>00482     <span class="keywordtype">int</span> DE;       <span class="comment">// DE of reference entity or zero.</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   };
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00487"></a>00487   <span class="keyword">struct </span>NurbSurface  : <span class="keyword">public</span> Entity
<a name="l00488"></a>00488   {
<a name="l00489"></a>00489     <span class="keyword">const</span> <span class="keyword">static</span> TCHAR * sForms[11] ;
<a name="l00490"></a>00490     <span class="keyword">enum</span> FormFactor { TBD=0, Plane=1, RightCircularCylinder=2, Cone=3, Sphere=4, Torus=5,
<a name="l00491"></a>00491       SurfaceOfRevolution=6, TabulatedCylinder=7, RuledSurface=8, GeneralQuadricSurface=9};
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     NurbSurface(){ type=ID=128;  m_szEntityName=_T(<span class="stringliteral">"NurbSurfaceEntity"</span>);}
<a name="l00494"></a>00494     ~NurbSurface() {  }
<a name="l00495"></a>00495 
<a name="l00497"></a>00497     <span class="keyword">virtual</span> CString ToString();
<a name="l00498"></a>00498     <a class="code" href="classVec.html">Vector</a> CalcPoint(<span class="keywordtype">float</span> s, <span class="keywordtype">float</span> t, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j);
<a name="l00499"></a>00499 
<a name="l00501"></a>00501     <span class="keywordtype">int</span> K1, K2, M1, M2;           <span class="comment">// N=upper index, M=degree</span>
<a name="l00502"></a>00502     <span class="keywordtype">int</span> PROP1, PROP2, PROP3, PROP4, PROP5; <span class="comment">//  prop1=1st closed, prop2=2nd closed, prop3(0=rational, 1=polynomial), prop4/5- 1-2 periodic</span>
<a name="l00503"></a>00503     <span class="keywordtype">int</span> N1, N2, A,B,C; <span class="comment">// derived</span>
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     FloatList  Ss;
<a name="l00506"></a>00506     FloatList  Ts;
<a name="l00507"></a>00507     Array2D&lt;float&gt; Ws;
<a name="l00508"></a>00508     Array2D&lt;Vector&gt;  Pts;
<a name="l00509"></a>00509     <span class="keywordtype">float</span>  U[2];
<a name="l00510"></a>00510     <span class="keywordtype">float</span>  V[2];
<a name="l00511"></a>00511 
<a name="l00512"></a>00512   };
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="keyword">struct </span>OffsetCurve  : <span class="keyword">public</span> Entity
<a name="l00516"></a>00516   {
<a name="l00517"></a>00517     OffsetCurve();
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">//virtual double DrawRaw(IPnts * pPts);</span>
<a name="l00521"></a>00521     <span class="comment">//virtual double DrawOGL(CFeatureList * pPts);</span>
<a name="l00523"></a>00523 <span class="comment"></span>    <span class="keywordtype">long</span> DE1;       <span class="comment">// DE of reference entity to be offset.</span>
<a name="l00524"></a>00524     <span class="keywordtype">long</span> FLAG;        <span class="comment">// offset distance flag, 1= single value offset, 2=varying linearly, 3=distance as function</span>
<a name="l00525"></a>00525     <span class="keywordtype">long</span> DE2;       <span class="comment">// DE of reference to curve which describes offset or zero.</span>
<a name="l00526"></a>00526     <span class="keywordtype">long</span> NDIM;        <span class="comment">// pointer of particualr coordinate of DE2 which describes offset as a function (only if FLAG=3)</span>
<a name="l00527"></a>00527     <span class="keywordtype">long</span> PTYPE;       <span class="comment">// tapered offset type flat, 1=function of arc length, 2-function of parameter</span>
<a name="l00528"></a>00528     <span class="keywordtype">float</span> D1;       <span class="comment">// first offset disance (only if FLAG=1 or=2)</span>
<a name="l00529"></a>00529     <span class="keywordtype">float</span> TD1;        <span class="comment">// arc length or parameter value depending on PTYPE, of first offset distance (FLAG=2)</span>
<a name="l00530"></a>00530     <span class="keywordtype">float</span> D2;       <span class="comment">// first offset disance (only if FLAG=1 or=2)</span>
<a name="l00531"></a>00531     <span class="keywordtype">float</span> TD2;        <span class="comment">// arc length or parameter value depending on PTYPE, of second offset distance (FLAG=2)</span>
<a name="l00532"></a>00532     <span class="keywordtype">double</span> VX,VY,VZ;    <span class="comment">// unit vector normal to plane containing curve to be offset</span>
<a name="l00533"></a>00533     <span class="keywordtype">double</span> TT1, TT2;    <span class="comment">// Offset curve starting and ending parameter value</span>
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   };
<a name="l00536"></a>00536 
<a name="l00537"></a>00537   <span class="comment">// Connect Point Entity - 132</span>
<a name="l00538"></a>00538   <span class="comment">// Node Entity - 134</span>
<a name="l00539"></a>00539   <span class="comment">// Finite Element Entity - 136 </span>
<a name="l00540"></a>00540   <span class="comment">// Nodal Displacement and Rotation Entity - 138</span>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   <span class="keyword">struct </span>OffsetSurface  : <span class="keyword">public</span> Entity
<a name="l00543"></a>00543   {
<a name="l00544"></a>00544     OffsetSurface(){ type=ID=140;  m_szEntityName=_T(<span class="stringliteral">"OffsetSurfaceEntity"</span>);}
<a name="l00546"></a>00546 
<a name="l00548"></a>00548     <span class="keywordtype">float</span> NX,NY,NZ;  <span class="comment">// x,y,z coordinate of offset indicate N(U,mV,m)</span>
<a name="l00549"></a>00549     <span class="keywordtype">float</span> D; <span class="comment">//  distance by which the surface is normally offset on the sidef ot he offset indicator if d&gt;0 opposite if d&lt;0</span>
<a name="l00550"></a>00550     <span class="keywordtype">long</span> PE; <span class="comment">// pointer to surface entity to be offset</span>
<a name="l00551"></a>00551   };
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="keyword">struct </span>CurveParametricSurface : <span class="keyword">public</span> Entity
<a name="l00554"></a>00554   {
<a name="l00555"></a>00555     CurveParametricSurface();
<a name="l00556"></a>00556     <span class="keyword">enum</span> CRTNEnum { Unspecified=0, ProjectionCurveOntoSurface=1, IntersectionTwoSurfaces=2, Isometric=3};
<a name="l00557"></a>00557     <span class="keyword">enum</span> PrefEnum { Unspec=0, SoB=1, CPreferred=2, CorBEqual=3};
<a name="l00559"></a>00559     <span class="keyword">virtual</span> CString ToString();
<a name="l00561"></a>00561     <span class="keywordtype">long</span> CTRN; <span class="comment">// indicates the way the curve on the suface has been created</span>
<a name="l00562"></a>00562     <span class="keywordtype">long</span> SPTR;  <span class="comment">// pointer to the surface on which the curve lies</span>
<a name="l00563"></a>00563     <span class="keywordtype">long</span> BPTR;  <span class="comment">// pointer to the entity that contains the definition of curve B in the parametric space(u,v,) of surface S</span>
<a name="l00564"></a>00564     <span class="keywordtype">long</span> CPTR;  <span class="comment">// pionter to the curve C</span>
<a name="l00565"></a>00565     <span class="keywordtype">long</span> PREF;  <span class="comment">// indicates the prerred representation in the sending system</span>
<a name="l00566"></a>00566   };
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   <span class="keyword">struct </span>TrimmedSurface  : <span class="keyword">public</span> Entity
<a name="l00569"></a>00569   {
<a name="l00570"></a>00570     TrimmedSurface(){ type=ID=144;  m_szEntityName=_T(<span class="stringliteral">"TrimmedSurfaceEntity"</span>);}
<a name="l00572"></a>00572     <span class="keyword">virtual</span> HRESULT ReadParameters(CString str, CString szFieldDelim=_T(<span class="stringliteral">","</span>), CString szEndDelim=_T(<span class="stringliteral">";"</span>));
<a name="l00573"></a>00573     <span class="keyword">virtual</span> CString ToString();
<a name="l00575"></a>00575     <span class="keywordtype">long</span> PTS; <span class="comment">// pointer to surface entity to be trimmed</span>
<a name="l00576"></a>00576     <span class="keywordtype">long</span> N1;  <span class="comment">// =0 if the outer boundary is the boundary of D, =1 otherwise</span>
<a name="l00577"></a>00577     <span class="keywordtype">long</span> N2;  <span class="comment">// indicates the number of simple closed curves which constitute the inner boundary of the trimmed surface.</span>
<a name="l00578"></a>00578     <span class="keywordtype">long</span> PT0; <span class="comment">// pointer to the simple closed curve (Curve on a Parametric Surface Entity) constitutes outer boundary or 0</span>
<a name="l00579"></a>00579     CIntArray PTs;  <span class="comment">// pointer to 1..n2 simple closed inner boundary curve (Curve on a Parametric Surface Entity)</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   };
<a name="l00582"></a>00582   <span class="comment">// CSG Block Entity - 150</span>
<a name="l00583"></a>00583   <span class="comment">// CSG Right Angle Wedge Entity - 152</span>
<a name="l00584"></a>00584   <span class="comment">// CSG Right Circular Cylinder Entity - 154</span>
<a name="l00585"></a>00585   <span class="comment">// CSG Right Circular Cone Frustrum Entity - 156</span>
<a name="l00586"></a>00586   <span class="comment">// CSG Sphere Entity - 158</span>
<a name="l00587"></a>00587   <span class="comment">// CSG Torus Entity - 160</span>
<a name="l00588"></a>00588   <span class="comment">// CSG Solid of Revolution Entity - 162</span>
<a name="l00589"></a>00589   <span class="comment">// CSG Solid of Linear Extrusion Entity - 164</span>
<a name="l00590"></a>00590   <span class="comment">// CSG Ellipsoid Entity - 164</span>
<a name="l00591"></a>00591   <span class="comment">// CSG Boolean Tree Entity - 180</span>
<a name="l00592"></a>00592   <span class="comment">// CSG Solid Instance Entity - 430</span>
<a name="l00593"></a>00593   <span class="comment">// CSG Solid Assembly Entity - 184</span>
<a name="l00594"></a>00594 
<a name="l00596"></a>00596   <span class="comment">// Annotations</span>
<a name="l00597"></a>00597   <span class="keyword">struct </span>AngularDimension : <span class="keyword">public</span> Entity
<a name="l00598"></a>00598   {
<a name="l00599"></a>00599     AngularDimension();
<a name="l00601"></a>00601     <span class="keyword">virtual</span> CString ToString();
<a name="l00603"></a>00603     <span class="keywordtype">int</span> DENOTE;     <span class="comment">// pointer to general note directory entry</span>
<a name="l00604"></a>00604     <span class="keywordtype">int</span> DEWIT1;     <span class="comment">// pointer to witness line ; 0 if not defined</span>
<a name="l00605"></a>00605     <span class="keywordtype">int</span> DEWIT2;     <span class="comment">// pointer to witness line ; 0 if not defined</span>
<a name="l00606"></a>00606     <span class="keywordtype">float</span> XT;     <span class="comment">// coordinates of vertex point</span>
<a name="l00607"></a>00607     <span class="keywordtype">float</span> YT;     <span class="comment">// coordinates of vertex point</span>
<a name="l00608"></a>00608     <span class="keywordtype">float</span> R;      <span class="comment">// radius of leader arcs</span>
<a name="l00609"></a>00609     <span class="keywordtype">int</span> DEARRW1;    <span class="comment">// pointer to first leader directory entry</span>
<a name="l00610"></a>00610     <span class="keywordtype">int</span> DEARRW2;    <span class="comment">// pointer to second leader directory entry</span>
<a name="l00611"></a>00611   };
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="keyword">struct </span>DiameterDimension : <span class="keyword">public</span> Entity
<a name="l00614"></a>00614   {
<a name="l00615"></a>00615     DiameterDimension();
<a name="l00617"></a>00617     <span class="keyword">virtual</span> CString ToString();
<a name="l00619"></a>00619     <span class="keywordtype">int</span> DENOTE;     <span class="comment">// pointer to general note directory entry</span>
<a name="l00620"></a>00620     <span class="keywordtype">int</span> DEARRW1;    <span class="comment">// pointer to first leader directory entry</span>
<a name="l00621"></a>00621     <span class="keywordtype">int</span> DEARRW2;    <span class="comment">// pointer to second leader directory entry</span>
<a name="l00622"></a>00622     <span class="keywordtype">float</span> XT;     <span class="comment">// arc center coordinates </span>
<a name="l00623"></a>00623     <span class="keywordtype">float</span> YT;     <span class="comment">// arc center coordinates </span>
<a name="l00624"></a>00624   };
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   <span class="keyword">struct </span>FlagNote : <span class="keyword">public</span> Entity
<a name="l00627"></a>00627   {
<a name="l00628"></a>00628     FlagNote(){ type=ID=208;  m_szEntityName=_T(<span class="stringliteral">"FlagNoteEntity"</span>);}
<a name="l00629"></a>00629 
<a name="l00631"></a>00631     <span class="keyword">virtual</span> HRESULT ReadParameters(CString str, CString szFieldDelim=_T(<span class="stringliteral">","</span>), CString szEndDelim=_T(<span class="stringliteral">";"</span>));
<a name="l00632"></a>00632     <span class="keyword">virtual</span> CString ToString();
<a name="l00634"></a>00634     <span class="keywordtype">float</span> XT,YT, ZT;  <span class="comment">// lower left corner  coordinates </span>
<a name="l00635"></a>00635     <span class="keywordtype">float</span> A;      <span class="comment">// rotation angle in radians</span>
<a name="l00636"></a>00636     <span class="keywordtype">int</span> DENOTE;     <span class="comment">// pointer to general note directory entry</span>
<a name="l00637"></a>00637     <span class="keywordtype">int</span> N;        <span class="comment">// number of associated leaders</span>
<a name="l00638"></a>00638     CIntArray DEARRWs;    <span class="comment">// pointer to accoiated leaders directory entry</span>
<a name="l00639"></a>00639   };
<a name="l00640"></a>00640   <span class="keyword">struct </span>GeneralNote : <span class="keyword">public</span> Entity
<a name="l00641"></a>00641   {
<a name="l00642"></a>00642     <span class="keyword">struct  </span>CNoteData {
<a name="l00643"></a>00643       <span class="keywordtype">int</span> m_nCount;
<a name="l00644"></a>00644       <span class="keywordtype">double</span> m_dWidth;
<a name="l00645"></a>00645       <span class="keywordtype">double</span> m_dHeight;
<a name="l00646"></a>00646       <span class="keywordtype">int</span> m_nFontCharacteristic;
<a name="l00647"></a>00647       <span class="keywordtype">double</span> m_nSlantAngle; <span class="comment">//radians</span>
<a name="l00648"></a>00648       <span class="keywordtype">double</span> m_dRotation;
<a name="l00649"></a>00649       <span class="keywordtype">int</span> m_nMirror; <span class="comment">// 0 - no mirroring, 1 - mirror axis is perpendicular, 2= mirror axis is text base line</span>
<a name="l00650"></a>00650       <span class="keywordtype">long</span> m_nVH;
<a name="l00651"></a>00651       <span class="keywordtype">float</span> X1;  <span class="comment">// 1- X start point</span>
<a name="l00652"></a>00652       <span class="keywordtype">float</span> Y1;  <span class="comment">// 2- Y  start point</span>
<a name="l00653"></a>00653       <span class="keywordtype">float</span> Z1;  <span class="comment">// depth from XY, XY plane</span>
<a name="l00654"></a>00654       CString m_sGeneralNote;
<a name="l00655"></a>00655     } ;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     GeneralNote(){ type=ID=212;  m_szEntityName=_T(<span class="stringliteral">"GeneralNoteEntity"</span>); m_nStrings=0;}
<a name="l00658"></a>00658 
<a name="l00660"></a>00660     <span class="keyword">virtual</span> CString ToString();
<a name="l00662"></a>00662     <span class="keywordtype">int</span> m_nStrings;
<a name="l00663"></a>00663     std::vector&lt;CNoteData&gt; m_notes;
<a name="l00664"></a>00664   };
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   <span class="keyword">struct </span>Leader  : <span class="keyword">public</span> Entity
<a name="l00667"></a>00667   {
<a name="l00668"></a>00668     Leader() { ID=214;  m_szEntityName=_T(<span class="stringliteral">"LeaderEntity"</span>);  }
<a name="l00670"></a>00670     <span class="keyword">virtual</span> CString ToString();
<a name="l00672"></a>00672     <span class="keywordtype">int</span> N;
<a name="l00673"></a>00673     <span class="keywordtype">double</span> dHeight, dWidth, dZdepth;
<a name="l00674"></a>00674     VectorList  P;
<a name="l00675"></a>00675   };
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="keyword">struct </span>LinearDimension  : <span class="keyword">public</span> Entity
<a name="l00678"></a>00678   {
<a name="l00679"></a>00679     LinearDimension();
<a name="l00681"></a>00681     <span class="keyword">virtual</span> CString ToString();
<a name="l00683"></a>00683     <span class="keywordtype">int</span> DENOTE;     <span class="comment">// pointer to general note directory entry</span>
<a name="l00684"></a>00684     <span class="keywordtype">int</span> DEARRW1;    <span class="comment">// pointer to first leader directory entry</span>
<a name="l00685"></a>00685     <span class="keywordtype">int</span> DEARRW2;    <span class="comment">// pointer to second leader directory entry</span>
<a name="l00686"></a>00686     <span class="keywordtype">int</span> DEWIT1;     <span class="comment">// pointer to witness line ; 0 if not defined</span>
<a name="l00687"></a>00687     <span class="keywordtype">int</span> DEWIT2;     <span class="comment">// pointer to witness line ; 0 if not defined</span>
<a name="l00688"></a>00688 
<a name="l00689"></a>00689   };
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <span class="keyword">struct </span>Color : <span class="keyword">public</span> Entity
<a name="l00692"></a>00692   {
<a name="l00693"></a>00693     Color();
<a name="l00695"></a>00695     <span class="keyword">virtual</span> CString ToString();
<a name="l00696"></a>00696     COLORREF GetColor() { <span class="keywordflow">return</span> RGB((<span class="keywordtype">short</span>)((CC1*256)/100), (<span class="keywordtype">short</span>)((CC2*256)/100),(<span class="keywordtype">short</span>)((CC3*256)/100)); }
<a name="l00698"></a>00698     <span class="keywordtype">float</span> CC1;      <span class="comment">// red</span>
<a name="l00699"></a>00699     <span class="keywordtype">float</span> CC2;      <span class="comment">// green</span>
<a name="l00700"></a>00700     <span class="keywordtype">float</span> CC3;      <span class="comment">// blue</span>
<a name="l00701"></a>00701     CString name;   <span class="comment">// name</span>
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   };
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <span class="keyword">struct </span>CPropertyType  : <span class="keyword">public</span> Entity
<a name="l00706"></a>00706   {
<a name="l00707"></a>00707     <span class="keyword">enum</span> FormFactor { TBD=0, Levels=1, RegionRestriction=2, LevelFunction=3, LineWidening=5, DrilledHole=6, 
<a name="l00708"></a>00708       ReferenceDesignator=7, PinNumber=8, PortNumber=9, Hierarchy=10, TableData=11};
<a name="l00709"></a>00709     CPropertyType(){ type=ID=406;  m_szEntityName=_T(<span class="stringliteral">"CPropertyTypeEntity"</span>); }
<a name="l00711"></a>00711     <span class="keyword">virtual</span> CString ToString();
<a name="l00713"></a>00713     <span class="keywordtype">float</span> NP;     <span class="comment">// number properties</span>
<a name="l00714"></a>00714     <span class="comment">// Form1 - Levels</span>
<a name="l00715"></a>00715     std::vector&lt;int&gt; Ls;    <span class="comment">// pointer to associated level numbers</span>
<a name="l00716"></a>00716     <span class="comment">// Form2 - RegionRestriction not handled</span>
<a name="l00717"></a>00717     <span class="keywordtype">int</span> EVR, ECPR, ECCRR;   <span class="comment">// pointer to associated level numbers</span>
<a name="l00718"></a>00718     <span class="comment">// Form3 - not handled</span>
<a name="l00719"></a>00719     <span class="keywordtype">int</span> FC, FD;
<a name="l00720"></a>00720     <span class="comment">// Form15 - Name</span>
<a name="l00721"></a>00721     CString Name;
<a name="l00722"></a>00722   };
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="keyword">class </span>IgesModel
<a name="l00727"></a>00727   {
<a name="l00728"></a>00728   <span class="keyword">public</span>:
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     IgesModel() {  }
<a name="l00731"></a>00731     ~IgesModel(){ Clear(); }
<a name="l00733"></a>00733     <span class="keywordtype">void</span> Clear();
<a name="l00734"></a>00734     <span class="keywordtype">void</span> *  Read(CString szFilename);
<a name="l00735"></a>00735     <span class="keywordtype">void</span> *  Write(CString szFilename);
<a name="l00736"></a>00736     Entity * AddEntity(Entity * pEntity);
<a name="l00737"></a>00737     <span class="keywordtype">void</span> SetFilename(CString);
<a name="l00738"></a>00738     <span class="keywordtype">void</span> SetAuthor(CString);
<a name="l00739"></a>00739     <span class="keywordtype">void</span> SetOrganization(CString );
<a name="l00740"></a>00740     <span class="keywordtype">void</span> SetUnits(Units );
<a name="l00741"></a>00741     <span class="keywordtype">void</span> SetDateTime(FILETIME );
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     Entity * CreateIgesModelFromFile(CString str);
<a name="l00745"></a>00745     HRESULT  ExtractParams(Entity *, CString);
<a name="l00746"></a>00746     CString ToString(); 
<a name="l00747"></a>00747     <span class="keywordtype">double</span> GetResolution(){ <span class="keywordflow">return</span> m_dResolution; }
<a name="l00748"></a>00748     <span class="keywordtype">void</span> SetResolution(<span class="keywordtype">double</span> dResolution){ m_dResolution=dResolution; }
<a name="l00749"></a>00749     <span class="comment">//  Entity * FindEntity(int n) { return gEntities.igesGetEntity(n); }</span>
<a name="l00750"></a>00750     <span class="comment">//    void  ComputeMinsMaxs();</span>
<a name="l00751"></a>00751     <span class="keywordtype">double</span> GetMax();
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     ModelGlobals gIgesGlobals;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="keyword">static</span> std::vector&lt;ColorMap&gt; igesColorIndex;
<a name="l00756"></a>00756     CString sParameterDelimiter,sRecordDelimiter,sProductId,sFilename,sSystemId,sPreprocessVersion; <span class="comment">// 1</span>
<a name="l00757"></a>00757     <span class="keywordtype">int</span> nIntegerBits,nMaxPowerTenFloat,nFloatingSignificantDigits,nMaxPowerTenDouble,nFloatingSignificantDigitsDbl;       <span class="comment">// 7</span>
<a name="l00758"></a>00758     CString sProductIdReceiving;  <span class="comment">// 12</span>
<a name="l00759"></a>00759     <span class="keywordtype">float</span> dModelSpaceScale;   <span class="comment">// 13</span>
<a name="l00760"></a>00760     <span class="keywordtype">int</span> nUnits; <span class="comment">// 14  1=inches, 2=mm, 3=, 4=feet, 5=miles, 6=meters</span>
<a name="l00761"></a>00761     CString sUnits; <span class="comment">// 15</span>
<a name="l00762"></a>00762     <span class="keywordtype">int</span> nMaxNumberLineWeight; <span class="comment">// 16</span>
<a name="l00763"></a>00763     <span class="keywordtype">float</span> dMaxLineWeightInUnits;  <span class="comment">// 17</span>
<a name="l00764"></a>00764     CString sDateTime;  <span class="comment">// 18</span>
<a name="l00765"></a>00765     <span class="keywordtype">float</span> dMinResolution; <span class="comment">// 19</span>
<a name="l00766"></a>00766     <span class="keywordtype">float</span> dMaxCoordinateValue;  <span class="comment">// 20</span>
<a name="l00767"></a>00767     CString sAuthor;  <span class="comment">// 21</span>
<a name="l00768"></a>00768     CString sOrganization;  <span class="comment">// 22</span>
<a name="l00769"></a>00769     <span class="keywordtype">int</span> nIgesVersion; <span class="comment">// 22</span>
<a name="l00770"></a>00770     <span class="keywordtype">int</span> nDraftingStandard;  <span class="comment">// 23</span>
<a name="l00771"></a>00771     CString sSpecial1;  <span class="comment">// 24</span>
<a name="l00772"></a>00772     CString sSpecial2;  <span class="comment">// 25</span>
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     CString errmsg;
<a name="l00775"></a>00775     <span class="keywordtype">long</span> m_nCurrentLine;
<a name="l00776"></a>00776     <span class="keywordtype">double</span> m_dResolution;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   };
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 };
</pre></div></div>
<html>
<body>
</body>
</html>
