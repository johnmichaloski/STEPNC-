<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>StepNC++: linalg3d.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<h1>linalg3d.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// linalg3d.h</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="preprocessor">#pragma once</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "Misc.h"</span>  <span class="comment">// Include for debugging purposes</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#pragma warning( disable : 4244)</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#pragma warning( disable : 4305)</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 <span class="preprocessor">#define EPSILON 0.00001f</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#define PI 3.1415926</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#define TwoPI 6.28318531</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#define Deg2Rad(Ang) ((REAL)( Ang * PI / 180.0 ))</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#define Rad2Deg(Ang) ((REAL)( Ang * 180.0 / PI ))</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#define Sq(X) (X*X)</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#define Eq(X,Y,Z) fabs((X-Y)&lt;Z)</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define ZeroTolerance (0.00000001)</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="preprocessor">#define REAL float</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="keyword">typedef</span> REAL Point2d [2];        <span class="comment">/* 2d point */</span>
<a name="l00023"></a>00023 <span class="keyword">typedef</span> REAL Point3d [3];        <span class="comment">/* 3d point */</span>
<a name="l00024"></a>00024 <span class="keyword">typedef</span> REAL Point4d [4];
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00028"></a>00028 <span class="keyword">inline</span> <span class="keywordtype">int</span> sign(T x) { <span class="keywordflow">return</span> x &gt; 0 ? 1 : x &lt; 0 ? -1 : 0;}
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00031"></a>00031 <span class="keyword">inline</span> T abs(T x) {  <span class="keywordflow">return</span> x &lt; 0 ? -x : x; }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="comment">// REAL sqrt(REAL f) { if(f&lt;0) throw; else return ::sqrt(f); }</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// =========================================</span>
<a name="l00038"></a>00038 <span class="comment">// 3-vector</span>
<a name="l00039"></a>00039 <span class="comment">// =========================================</span>
<a name="l00040"></a><a class="code" href="classVec.html">00040</a> <span class="keyword">class </span><a class="code" href="classVec.html">Vec</a>
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042 <span class="keyword">public</span>:
<a name="l00043"></a>00043   
<a name="l00044"></a>00044   REAL x, y, z, w; <span class="comment">// Position &amp; weight</span>
<a name="l00045"></a>00045   <a class="code" href="classVec.html">Vec</a>(): x( 0 ), y( 0 ), z( 0 ), w(1) {} <span class="comment">// Default constructor</span>
<a name="l00046"></a>00046   <a class="code" href="classVec.html">Vec</a>( REAL x, REAL y, REAL z ) : x( x ), y( y ), z( z ), w(1)  {} <span class="comment">// Element constructor</span>
<a name="l00047"></a>00047   <a class="code" href="classVec.html">Vec</a>( REAL _x[3]) : x( _x[0] ), y( _x[1] ), z( _x[2] ), w(1)   {} <span class="comment">// Element constructor</span>
<a name="l00048"></a>00048   <a class="code" href="classVec.html">Vec</a>( REAL x, REAL y, REAL z, REAL w ) : x( x ), y( y ), z( z ), w(w)  {} <span class="comment">// Element constructor</span>
<a name="l00049"></a>00049   <a class="code" href="classVec.html">Vec</a>( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; a ) : x( a.x ), y( a.y ), z( a.z ) , w(a.w) {}<span class="comment">// Copy constructor</span>
<a name="l00050"></a>00050   REAL &amp; operator ()(<span class="keywordtype">int</span> n) { <span class="keywordflow">return</span> ( (n==0)?  x : (n==1) ? y: z ); }
<a name="l00051"></a>00051   REAL &amp; operator [](<span class="keywordtype">int</span> n) { <span class="keywordflow">return</span> ( (n==0)?  x : (n==1) ? y: z ); }
<a name="l00052"></a>00052   <a class="code" href="classVec.html">Vec</a> &amp;operator += ( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;src ) { x += src.x; y += src.y; z += src.z; w += src.w; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00053"></a>00053   <a class="code" href="classVec.html">Vec</a> operator + ( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;src )<span class="keyword"> const </span>{ <a class="code" href="classVec.html">Vec</a> tmp( *<span class="keyword">this</span> ); <span class="keywordflow">return</span> ( tmp += src ); }
<a name="l00054"></a>00054   <a class="code" href="classVec.html">Vec</a> &amp;operator -= ( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;src ) { x -= src.x; y -= src.y; z -= src.z; w -= src.w; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00055"></a>00055   <a class="code" href="classVec.html">Vec</a> operator - ( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;src )<span class="keyword"> const </span>{ <a class="code" href="classVec.html">Vec</a> tmp( *<span class="keyword">this</span> ); <span class="keywordflow">return</span> ( tmp -= src ); }
<a name="l00056"></a>00056   <a class="code" href="classVec.html">Vec</a> operator - ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vec</a>(-x,-y,-z); }
<a name="l00057"></a>00057   <a class="code" href="classVec.html">Vec</a> &amp;operator *= ( <span class="keyword">const</span> REAL src ) { x *= src; y *= src; z *= src;  w *= src; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00058"></a>00058   <a class="code" href="classVec.html">Vec</a> operator * ( <span class="keyword">const</span> REAL src )<span class="keyword"> const </span>{ <a class="code" href="classVec.html">Vec</a> tmp( *<span class="keyword">this</span> ); <span class="keywordflow">return</span> ( tmp *= src ); }
<a name="l00059"></a>00059   <a class="code" href="classVec.html">Vec</a> &amp;operator /= ( <span class="keyword">const</span> REAL src ) { x /= src; y /= src; z /= src; w /= src; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00060"></a>00060   <a class="code" href="classVec.html">Vec</a> operator / ( <span class="keyword">const</span> REAL src )<span class="keyword"> const </span>{ <a class="code" href="classVec.html">Vec</a> tmp( *<span class="keyword">this</span> ); <span class="keywordflow">return</span> ( tmp /= src ); }
<a name="l00061"></a>00061   <span class="keywordtype">bool</span> operator == ( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ((*<span class="keyword">this</span>)-b).Norm() &lt; EPSILON; }
<a name="l00062"></a>00062   <span class="keywordtype">bool</span> operator != ( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !(((*this)-b).<a class="code" href="classVec.html#e7ebc378dc39253e17ad8c4cac420d20">Norm</a>() &lt; EPSILON); }
<a name="l00063"></a>00063   <span class="comment">//  REAL &amp; operator () (int i) { REAL &amp; ptrD(x); return ptrD+=(sizeof(REAL)*i); }</span>
<a name="l00064"></a>00064   <span class="comment">//bool operator == ( const Vec&amp; b) const { return x==b.x &amp;&amp; y==b.y &amp;&amp; z==b.z; }</span>
<a name="l00065"></a><a class="code" href="classVec.html#e7ebc378dc39253e17ad8c4cac420d20">00065</a>   <span class="keyword">inline</span> REAL <a class="code" href="classVec.html#e7ebc378dc39253e17ad8c4cac420d20">Norm</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> x*x + y*y + z*z; } <span class="comment">// Norm (len^2)</span>
<a name="l00066"></a><a class="code" href="classVec.html#63cccf9920a5f8433cde2612b83df943">00066</a>   <span class="keyword">inline</span> REAL <a class="code" href="classVec.html#63cccf9920a5f8433cde2612b83df943">Len</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> sqrt(<a class="code" href="classVec.html#e7ebc378dc39253e17ad8c4cac420d20">Norm</a>()); } <span class="comment">// Length of the vector</span>
<a name="l00067"></a><a class="code" href="classVec.html#021b7dfcbe29646a2551e5d771215466">00067</a>   <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html#021b7dfcbe29646a2551e5d771215466">Normalize</a>(){ <a class="code" href="classVec.html">Vec</a> tmp( *<span class="keyword">this</span> ); <span class="keywordflow">return</span> ( tmp /= <a class="code" href="classVec.html#63cccf9920a5f8433cde2612b83df943">Len</a>() ); }
<a name="l00068"></a>00068   <a class="code" href="classVec.html">Vec</a> Inverse(){ <a class="code" href="classVec.html">Vec</a> tmp( *<span class="keyword">this</span> ); <span class="keywordflow">return</span> ( tmp /= <a class="code" href="classVec.html#e7ebc378dc39253e17ad8c4cac420d20">Norm</a>() ); }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <span class="keyword">enum</span> {XY=3, XZ=5, YZ=6, ZX=7}; <span class="comment">// change with vector array of ordering, 0 if none.</span>
<a name="l00071"></a><a class="code" href="classVec.html#3e89a84c2d82b377afdcd71dc7005cf0">00071</a>   <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html#3e89a84c2d82b377afdcd71dc7005cf0">Slice</a>(<span class="keywordtype">int</span> nBits) { 
<a name="l00072"></a>00072     <a class="code" href="classVec.html">Vec</a> tmp(*<span class="keyword">this</span>);   
<a name="l00073"></a>00073     <span class="keywordflow">if</span> (nBits==XZ) tmp.y=tmp.z; 
<a name="l00074"></a>00074     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nBits==YZ) { tmp.x=tmp.y; tmp.y=tmp.z; }
<a name="l00075"></a>00075     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nBits==ZX) { tmp.y=tmp.x; tmp.x=tmp.z; }
<a name="l00076"></a>00076     tmp.z=0;
<a name="l00077"></a>00077     <span class="keywordflow">return</span> tmp;
<a name="l00078"></a>00078   }
<a name="l00079"></a>00079   <a class="code" href="classVec.html">Vec</a> Unslice(<span class="keywordtype">int</span> nBits) { 
<a name="l00080"></a>00080     <a class="code" href="classVec.html">Vec</a> tmp(*<span class="keyword">this</span>);   
<a name="l00081"></a>00081     <span class="keywordflow">if</span> (nBits==XZ) tmp.z=tmp.y; 
<a name="l00082"></a>00082     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nBits==YZ) { tmp.y=tmp.x; tmp.z=tmp.y; }
<a name="l00083"></a>00083     <span class="keywordflow">return</span> tmp;
<a name="l00084"></a>00084   } 
<a name="l00085"></a>00085   CString ToString(CString sep=_T(<span class="stringliteral">""</span>)){ CString buf; buf.Format(_T(<span class="stringliteral">"%f%s %f%s %f"</span>), x,sep, y,sep, z); <span class="keywordflow">return</span>  buf ; <span class="comment">/*Not reentrant*/</span>}
<a name="l00086"></a>00086 
<a name="l00087"></a>00087   <a class="code" href="classVec.html">Vec</a>(<span class="keyword">const</span> std::vector&lt;double&gt; &amp;src): w(1) 
<a name="l00088"></a>00088   { 
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (src.size() &gt; 0)  x = src[0]; 
<a name="l00090"></a>00090     <span class="keywordflow">if</span>(src.size() &gt; 1)  y = src[1]; 
<a name="l00091"></a>00091     <span class="keywordflow">if</span>(src.size() &gt; 2)  z = src[2]; 
<a name="l00092"></a>00092   }
<a name="l00093"></a>00093   <a class="code" href="classVec.html">Vec</a> &amp;operator = ( <span class="keyword">const</span> std::vector&lt;double&gt; &amp;src ) 
<a name="l00094"></a>00094   { 
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (src.size() &gt; 0)  x = src[0]; 
<a name="l00096"></a>00096     <span class="keywordflow">if</span>(src.size() &gt; 1)  y = src[1]; 
<a name="l00097"></a>00097     <span class="keywordflow">if</span>(src.size() &gt; 2)  z = src[2]; 
<a name="l00098"></a>00098     <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
<a name="l00099"></a>00099   }
<a name="l00100"></a>00100 };
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="classVec.html#ddfee8c631659299a33c6b91effae126">00102</a> <span class="keyword">inline</span> REAL <a class="code" href="classVec.html#ddfee8c631659299a33c6b91effae126">Dot</a>(<span class="keyword">const</span>  <a class="code" href="classVec.html">Vec</a>&amp; a,<span class="keyword">const</span>  <a class="code" href="classVec.html">Vec</a>&amp; b ) { <span class="keywordflow">return</span> a.x*b.x + a.y*b.y + a.z*b.z; }
<a name="l00103"></a><a class="code" href="classVec.html#b8a383ecfbb5639ceea4f9c41d57f152">00103</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html#b8a383ecfbb5639ceea4f9c41d57f152">Cross</a>( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;a, <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;b ) { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vec</a>( a.y*b.z - a.z*b.y, a.z*b.x - a.x*b.z, a.x*b.y - a.y*b.x ); }
<a name="l00104"></a><a class="code" href="classVec.html#02facecf58728adfb647cba0daa6f186">00104</a> <span class="keyword">inline</span> REAL <a class="code" href="classVec.html#02facecf58728adfb647cba0daa6f186">Displacement</a>(<a class="code" href="classVec.html">Vec</a> &amp; u ,<a class="code" href="classVec.html">Vec</a> &amp;v) { <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vec</a>(u-v).Len(); } 
<a name="l00105"></a><a class="code" href="classVec.html#df7408e5d3de8240f9210e787cc5d737">00105</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a>  <a class="code" href="classVec.html#df7408e5d3de8240f9210e787cc5d737">Projection</a>( <a class="code" href="classVec.html">Vec</a> &amp; v1,  <a class="code" href="classVec.html">Vec</a>  &amp;v2) { <a class="code" href="classVec.html">Vec</a> tmp1(v2.<a class="code" href="classVec.html#021b7dfcbe29646a2551e5d771215466">Normalize</a>()); <span class="keywordflow">return</span> tmp1*=<a class="code" href="classVec.html#ddfee8c631659299a33c6b91effae126">Dot</a>(  v1, tmp1);}
<a name="l00106"></a><a class="code" href="classVec.html#bee5ddd654b2c8fc6c153cdace019645">00106</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a>  <a class="code" href="classVec.html#bee5ddd654b2c8fc6c153cdace019645">CartPlaneProj</a>( <a class="code" href="classVec.html">Vec</a> &amp;v,  <a class="code" href="classVec.html">Vec</a> &amp;normal) { <span class="keywordflow">return</span> v-<a class="code" href="classVec.html#df7408e5d3de8240f9210e787cc5d737">Projection</a>(v, normal);}
<a name="l00107"></a><a class="code" href="classVec.html#51f3f5cf496f8d6d072202fc059ad904">00107</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a>  <a class="code" href="classVec.html#51f3f5cf496f8d6d072202fc059ad904">Lerp</a>( <a class="code" href="classVec.html">Vec</a> &amp;v1,  <a class="code" href="classVec.html">Vec</a> &amp;v2, REAL scale) { <a class="code" href="classVec.html">Vec</a> tmp1( v1 ); <a class="code" href="classVec.html">Vec</a> tmp2(v2-v1); tmp2*=scale; <span class="keywordflow">return</span> tmp1+=tmp2; }
<a name="l00108"></a><a class="code" href="classVec.html#e9ebf22ca851a993ae36f7dca8d5215f">00108</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classVec.html#e9ebf22ca851a993ae36f7dca8d5215f">Perpendicular</a>(<span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;v1, <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;v2) { <span class="keywordflow">return</span> (fabs(<a class="code" href="classVec.html#ddfee8c631659299a33c6b91effae126">Dot</a>(v1,v2))&lt;EPSILON); }
<a name="l00109"></a><a class="code" href="classVec.html#5edd4f43bba7b2208388fc52da6f3a10">00109</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classVec.html#5edd4f43bba7b2208388fc52da6f3a10">Parallel</a>( <a class="code" href="classVec.html">Vec</a> &amp;v1,  <a class="code" href="classVec.html">Vec</a> &amp;v2) { <span class="keywordflow">return</span> ( <a class="code" href="classVec.html">Vec</a> (v1.<a class="code" href="classVec.html#021b7dfcbe29646a2551e5d771215466">Normalize</a>() - v2.<a class="code" href="classVec.html#021b7dfcbe29646a2551e5d771215466">Normalize</a>()).Len()&lt;EPSILON); }
<a name="l00110"></a><a class="code" href="classVec.html#5cc21b51876616294caed1c8df987de6">00110</a> <span class="keyword">inline</span> REAL <a class="code" href="classVec.html#5cc21b51876616294caed1c8df987de6">atan360</a>(REAL y1, REAL x1){ REAL a (atan2(y1,x1)); <span class="keywordflow">return</span> (a&lt;0)? a+ TwoPI : a; }
<a name="l00111"></a><a class="code" href="classVec.html#86548c02cdcb27c1b3665c6a59779f52">00111</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html#86548c02cdcb27c1b3665c6a59779f52">VMin</a>(<a class="code" href="classVec.html">Vec</a> &amp; v1, <a class="code" href="classVec.html">Vec</a> &amp; v2){ <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vec</a>((v1.x&lt;v2.x)? v1.x : v2.x, (v1.y&lt;v2.y)? v1.y : v2.y, (v1.z&lt;v2.z)? v1.z : v2.z); }
<a name="l00112"></a><a class="code" href="classVec.html#da9205035a8e4ebbc0d4f8a8c28c77aa">00112</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html#da9205035a8e4ebbc0d4f8a8c28c77aa">VMax</a>(<a class="code" href="classVec.html">Vec</a> &amp; v1, <a class="code" href="classVec.html">Vec</a> &amp; v2){ <span class="keywordflow">return</span> <a class="code" href="classVec.html">Vec</a>((v1.x&gt;v2.x)? v1.x : v2.x, (v1.y&gt;v2.y)? v1.y : v2.y, (v1.z&gt;v2.z)? v1.z : v2.z); }
<a name="l00113"></a><a class="code" href="classVec.html#fa5bb6806469c9a19dda666564c8d94d">00113</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classVec.html#fa5bb6806469c9a19dda666564c8d94d">VGt</a>(<a class="code" href="classVec.html">Vec</a> &amp; v1, <a class="code" href="classVec.html">Vec</a> &amp; v2){ <span class="keywordflow">return</span> (v1.x&gt;v2.x) || (v1.y&gt;v2.y) || (v1.z&gt;v2.z); }
<a name="l00114"></a><a class="code" href="classVec.html#6b9d88872791e6f8070155ff6e370850">00114</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classVec.html#6b9d88872791e6f8070155ff6e370850">VLt</a>(<a class="code" href="classVec.html">Vec</a> &amp; v1, <a class="code" href="classVec.html">Vec</a> &amp; v2){ <span class="keywordflow">return</span> (v1.x&lt;v2.x) || (v1.y&lt;v2.y) || (v1.z&lt;v2.z); }
<a name="l00115"></a><a class="code" href="classVec.html#4c8bda20d406217e8df7e41078d66f5b">00115</a> <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html#4c8bda20d406217e8df7e41078d66f5b">Direction</a>(<a class="code" href="classVec.html">Vec</a>   v1, <a class="code" href="classVec.html">Vec</a>   v2) { <span class="keywordflow">return</span> v2 - v1; }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">// make this a template type?</span>
<a name="l00119"></a>00119 <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classMtx.html#babfae73212bc11916914e92956bfacf">operator * </a>( <span class="keyword">const</span> REAL src, <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; v ) { <a class="code" href="classVec.html">Vec</a> tmp( v ); <span class="keywordflow">return</span> ( tmp *= src ); }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="keyword">typedef</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classVec.html">Vector</a>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="comment">// =========================================</span>
<a name="l00125"></a>00125 <span class="comment">// 4 x 4 matrix</span>
<a name="l00126"></a>00126 <span class="comment">// =========================================</span>
<a name="l00127"></a><a class="code" href="classMtx.html">00127</a> <span class="keyword">class </span><a class="code" href="classMtx.html">Mtx</a>
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129 <span class="keyword">public</span>:
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">int</span> order=4;
<a name="l00132"></a>00132   <span class="comment">// 4x4, [[0 1 2 3] [4 5 6 7] [8 9 10 11] [12 13 14 15]]</span>
<a name="l00133"></a>00133   REAL data[ 16 ];
<a name="l00134"></a>00134 
<a name="l00135"></a>00135   <span class="comment">// Creates an identity matrix</span>
<a name="l00136"></a>00136   <a class="code" href="classMtx.html">Mtx</a>()
<a name="l00137"></a>00137   {
<a name="l00138"></a>00138     <span class="keyword">static</span> REAL IdentityMatrix[16] = { 1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1 };
<a name="l00139"></a>00139     memcpy(<span class="keyword">this</span>,&amp;IdentityMatrix,<span class="keyword">sizeof</span>(REAL)*16);
<a name="l00140"></a>00140     <span class="comment">//for ( int i = 0; i &lt; 16; ++i )</span>
<a name="l00141"></a>00141     <span class="comment">//  data[ i ] = 0;</span>
<a name="l00142"></a>00142     <span class="comment">//data[ 0 + 0 ] = data[ 4 + 1 ] = data[ 8 + 2 ] = data[ 12 + 3 ] = 1;</span>
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144   <a class="code" href="classMtx.html">Mtx</a>( <span class="keyword">const</span> <a class="code" href="classMtx.html">Mtx</a>&amp; a ) { memcpy(<span class="keyword">this</span>,&amp;a,<span class="keyword">sizeof</span>(<a class="code" href="classMtx.html">Mtx</a>));}
<a name="l00145"></a>00145   <a class="code" href="classMtx.html">Mtx</a>( REAL d11, REAL d12, REAL d13,REAL d14,
<a name="l00146"></a>00146     REAL d21, REAL d22, REAL d23, REAL d24,
<a name="l00147"></a>00147     REAL d31, REAL d32, REAL d33, REAL d34,
<a name="l00148"></a>00148     REAL d41, REAL d42, REAL d43, REAL d44)
<a name="l00149"></a>00149   { 
<a name="l00150"></a>00150     <a class="code" href="classMtx.html#e9cd71fee81aaefe82cfd7e76f90afec">Load</a> (d11,  d12,  d13, d14,d21,  d22,  d23,  d24, d31,  d32,  d33,  d34, d41,  d42,  d43,  d44); 
<a name="l00151"></a>00151   }
<a name="l00152"></a>00152   <span class="comment">// Operators</span>
<a name="l00153"></a>00153   <a class="code" href="classMtx.html">Mtx</a> &amp; operator /=(REAL d) { <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; order*order; ++i ) data[i] /= d;  <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00154"></a>00154   <a class="code" href="classMtx.html">Mtx</a> &amp; operator *=(REAL d) { <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; order*order; ++i ) data[i] *= d;  <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00156"></a><a class="code" href="classMtx.html#043d3534f86f81f4afd2a0d5105d34d7">00156</a>   REAL <a class="code" href="classMtx.html#043d3534f86f81f4afd2a0d5105d34d7" title="!">operator () </a>( <span class="keywordtype">unsigned</span> column, <span class="keywordtype">unsigned</span> row )  { <span class="keywordflow">return</span> data[ column + ( row * 4 ) ]; }
<a name="l00157"></a>00157   REAL &amp; <a class="code" href="classMtx.html#043d3534f86f81f4afd2a0d5105d34d7" title="!">operator ()</a>(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col) { <span class="keywordflow">return</span> data[row * 4 + col]; }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="classMtx.html#e9cd71fee81aaefe82cfd7e76f90afec">00159</a>   <span class="keywordtype">void</span> <a class="code" href="classMtx.html#e9cd71fee81aaefe82cfd7e76f90afec">Load</a>( REAL d11, REAL d12, REAL d13,REAL d14,
<a name="l00160"></a>00160     REAL d21, REAL d22, REAL d23, REAL d24,
<a name="l00161"></a>00161     REAL d31, REAL d32, REAL d33, REAL d34,
<a name="l00162"></a>00162     REAL d41, REAL d42, REAL d43, REAL d44)
<a name="l00163"></a>00163   { 
<a name="l00164"></a>00164     va_list ap;
<a name="l00165"></a>00165     va_start(ap, d11);
<a name="l00166"></a>00166     memcpy(&amp;this-&gt;data,ap-<span class="keyword">sizeof</span>(REAL),<span class="keyword">sizeof</span>(REAL)*16);
<a name="l00167"></a>00167     va_end(ap);
<a name="l00168"></a>00168   }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="comment">// Returns the transpose of this matrix</span>
<a name="l00171"></a>00171   <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#9a5ff55ad09f716b067047a517c2bd98">Transpose</a>() <span class="keyword">const</span>;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   REAL <a class="code" href="classMtx.html#600a0c00e8cee76a3d8c2acb0e0544c4">Determinant</a>();
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   CString ToString(){ <span class="keywordflow">return</span> StrFormat(_T(<span class="stringliteral">"%f %f %f %f \n%f %f %f %f \n%f %f %f %f \n%f %f %f %f \n"</span>),
<a name="l00176"></a>00176     data[0],data[1],data[2],data[3],data[4],data[5],data[6],data[7],data[8],data[9],data[10],data[11],data[12],data[13],data[14],data[15]);
<a name="l00177"></a>00177   }
<a name="l00178"></a><a class="code" href="classMtx.html#8e084b4c5c6f5a7a6fb89eb349d0b150">00178</a>   <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#8e084b4c5c6f5a7a6fb89eb349d0b150">Rotation</a>() { <a class="code" href="classMtx.html">Mtx</a> tmp(*<span class="keyword">this</span>);  tmp.data[3]=tmp.data[7]=tmp.data[11]=0; tmp.data[15]=1;  <span class="keywordflow">return</span> tmp; }
<a name="l00179"></a><a class="code" href="classMtx.html#0db40546221953584d2d2f4465be71e6">00179</a>   Vector <a class="code" href="classMtx.html#0db40546221953584d2d2f4465be71e6">Translation</a>() { Vector tmp( data[3],data[7],data[11],data[15]);  <span class="keywordflow">return</span> tmp; }
<a name="l00180"></a><a class="code" href="classMtx.html#41c5fe4ef868e91de373ecd8406afbea">00180</a>   <span class="keywordtype">bool</span> <a class="code" href="classMtx.html#41c5fe4ef868e91de373ecd8406afbea">IsIdentity</a>() { 
<a name="l00181"></a>00181     <span class="keyword">static</span> REAL IdentityMatrix[16] = { 1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1 };
<a name="l00182"></a>00182     <span class="keywordflow">return</span> memcmp(<span class="keyword">this</span>,&amp;IdentityMatrix,<span class="keyword">sizeof</span>(REAL)*16)==0; 
<a name="l00183"></a>00183   } 
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 };
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="keyword">typedef</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html">Matrix</a>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">// Creates a scale matrix</span>
<a name="l00190"></a>00190 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#aeaf87a9fc814073fdcedd911017d6ec">Scale</a>( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;scale );
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">// Creates a translation matrix</span>
<a name="l00193"></a>00193 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#8b4dd2de83f2127feac893fb57bf8715">Translate</a>( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;moveAmt );
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">// Creates an euler rotation matrix (by X-axis)</span>
<a name="l00196"></a>00196 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#9f7113844d4aae16f3447374278d4e43">RotateX</a>( REAL ang );
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">// Creates an euler rotation matrix (by Y-axis)</span>
<a name="l00199"></a>00199 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#1df1a694dbb1b80db0047b6c808f3dfd">RotateY</a>( REAL ang );
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">// Creates an euler rotation matrix (by Z-axis)</span>
<a name="l00202"></a>00202 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#e5d23694429d522a4b2f4c079fd82b3e">RotateZ</a>( REAL ang );
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="comment">// Creates an euler rotation matrix (pitch/head/roll (x/y/z))</span>
<a name="l00205"></a>00205 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#86c6273c3ac98b76a779bf0f75c69079">Rotate</a>( REAL pitch, REAL head, REAL roll );
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">// Creates an arbitraty rotation matrix</span>
<a name="l00208"></a>00208 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#61f1a79ba957c8f35b7e4d6ff5af837d">MakeRotationMatrix</a>( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;dir, <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a> &amp;up );
<a name="l00209"></a>00209 <span class="comment">// Transforms a vector by a matrix</span>
<a name="l00210"></a>00210 <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classMtx.html#babfae73212bc11916914e92956bfacf">operator * </a>( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; v, <span class="keyword">const</span> <a class="code" href="classMtx.html">Mtx</a>&amp; m );
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">// Transforms a vector by a matrix</span>
<a name="l00213"></a>00213 <span class="keyword">inline</span> <a class="code" href="classVec.html">Vec</a> <a class="code" href="classMtx.html#babfae73212bc11916914e92956bfacf">operator * </a>( <span class="keyword">const</span> <a class="code" href="classMtx.html">Mtx</a>&amp; m, <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; v );
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">// Multiplies a matrix by another matrix</span>
<a name="l00216"></a>00216 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#babfae73212bc11916914e92956bfacf">operator * </a>( <span class="keyword">const</span> <a class="code" href="classMtx.html">Mtx</a>&amp; a, <span class="keyword">const</span> <a class="code" href="classMtx.html">Mtx</a>&amp; b );
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="classMtx.html#f5c00aeb6d55d7e7e56ff44307a2807c">Solve3</a> (<a class="code" href="classMtx.html">Mtx</a> &amp; A, <a class="code" href="classVec.html">Vec</a> &amp; b,  <a class="code" href="classVec.html">Vec</a> &amp; X);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a> <a class="code" href="classMtx.html#a7fa3d817e1723e8a6c11032b2ecf808">Inverse</a>(<a class="code" href="classMtx.html">Mtx</a> &amp;A) ;
<a name="l00221"></a>00221 <span class="keyword">inline</span> Matrix <a class="code" href="classMtx.html#5b092267502393253f0a0278b12f9001">MakeQRotationAroundAxis</a>(Vector v, <span class="keywordtype">double</span> dRadianAngle);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="comment">/* Perspective is along the z-axis with the eye at +z. d =Perspective distance    */</span>  
<a name="l00224"></a>00224 <span class="keyword">inline</span> <a class="code" href="classMtx.html">Mtx</a>  <a class="code" href="classMtx.html#3cac33e6d1169838c7e0b96270af83f4">Perspective</a> (<a class="code" href="classMtx.html">Mtx</a> &amp;m, REAL d);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">// =========================================</span>
<a name="l00227"></a>00227 <span class="comment">// Plane</span>
<a name="l00228"></a>00228 <span class="comment">// =========================================</span>
<a name="l00229"></a>00229 <span class="keyword">class </span>Plane
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231 <span class="keyword">public</span>:
<a name="l00232"></a>00232   <span class="keyword">enum</span> PLANE_EVAL
<a name="l00233"></a>00233   {
<a name="l00234"></a>00234     EVAL_COINCIDENT,
<a name="l00235"></a>00235     EVAL_IN_BACK_OF,
<a name="l00236"></a>00236     EVAL_IN_FRONT_OF,
<a name="l00237"></a>00237     EVAL_SPANNING
<a name="l00238"></a>00238   };
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <a class="code" href="classVec.html">Vec</a> normal;
<a name="l00241"></a>00241   REAL d;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="comment">// Default constructor</span>
<a name="l00244"></a>00244   Plane(): normal( 0,1,0 ), d( 0 ) {}
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="comment">// Vector form constructor</span>
<a name="l00247"></a>00247   <span class="comment">//   normal = normalized normal of the plane</span>
<a name="l00248"></a>00248   <span class="comment">//   pt = any point on the plane</span>
<a name="l00249"></a>00249   Plane( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; normal, <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; pt )
<a name="l00250"></a>00250     : normal( normal ), d( Dot( -normal, pt )) 
<a name="l00251"></a>00251   {}
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="comment">// Copy constructor</span>
<a name="l00254"></a>00254   Plane( <span class="keyword">const</span> Plane&amp; a )
<a name="l00255"></a>00255     : normal( a.normal ), d( a.d ) 
<a name="l00256"></a>00256   {}
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   <span class="comment">// Classifies a point (&lt;0 == back, 0 == on plane, &gt;0 == front)</span>
<a name="l00259"></a>00259   REAL classify( <span class="keyword">const</span> <a class="code" href="classVec.html">Vec</a>&amp; pt )<span class="keyword"> const</span>
<a name="l00260"></a>00260 <span class="keyword">  </span>{
<a name="l00261"></a>00261     REAL f = Dot( normal, pt ) + d;
<a name="l00262"></a>00262     <span class="keywordflow">return</span> ( f &gt; -EPSILON &amp;&amp; f &lt; EPSILON ) ? 0 : f;
<a name="l00263"></a>00263   }
<a name="l00264"></a>00264 };
<a name="l00265"></a>00265 
<a name="l00271"></a>00271 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00277"></a>00277 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00278"></a>00278 <span class="keyword">inline</span> T factorial(T rhs)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280    T lhs = (T)1;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    <span class="keywordflow">for</span>( T x = (T)1; x &lt;= rhs; ++x )
<a name="l00283"></a>00283    {
<a name="l00284"></a>00284       lhs *= x;
<a name="l00285"></a>00285    }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287    <span class="keywordflow">return</span> lhs;
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00293"></a>00293 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00294"></a>00294 <span class="keyword">inline</span> T clamp( T number, T lo, T hi )
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296    <span class="keywordflow">if</span> (number &gt; hi) number = hi;
<a name="l00297"></a>00297    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number &lt; lo) number = lo;
<a name="l00298"></a>00298    <span class="keywordflow">return</span> number;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 
<a name="l00307"></a>00307 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">typename</span> U&gt;
<a name="l00308"></a>00308 <span class="keyword">inline</span> <span class="keywordtype">void</span> lerp( T&amp; result, <span class="keyword">const</span> U&amp; lerp, <span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b )
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     T size = b - a;
<a name="l00311"></a>00311     result = ((U)a) + (((U)size) * lerp);
<a name="l00312"></a>00312 }
<a name="l00327"></a>00327 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00328"></a>00328 <span class="keyword">inline</span> <span class="keywordtype">bool</span> quadraticFormula(T&amp; r1, T&amp; r2, <span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b, <span class="keyword">const</span> T&amp; c)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330    <span class="keyword">const</span> T q = b*b - T(4)*a*c;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332    <span class="comment">// the result has real roots</span>
<a name="l00333"></a>00333    <span class="keywordflow">if</span> (q &gt;= 0)
<a name="l00334"></a>00334    {
<a name="l00335"></a>00335       <span class="keyword">const</span> T sq = gmtl::Math::sqrt(q);
<a name="l00336"></a>00336       <span class="keyword">const</span> T d = T(1) / (T(2) * a);
<a name="l00337"></a>00337       r1 = (-b + sq) * d;
<a name="l00338"></a>00338       r2 = (-b - sq) * d;
<a name="l00339"></a>00339       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341    <span class="comment">// the result has complex roots</span>
<a name="l00342"></a>00342    <span class="keywordflow">else</span>
<a name="l00343"></a>00343    {
<a name="l00344"></a>00344       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00345"></a>00345    }
<a name="l00346"></a>00346 }
<a name="l00349"></a>00349 <span class="comment">// Documentation</span>
<a name="l00350"></a>00350 <span class="comment">//#include "doc/linalg3dDoc.h"</span>
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="preprocessor">#include "linalg3dImpl.h"</span>
</pre></div></div>
<html>
<body>
</body>
</html>
